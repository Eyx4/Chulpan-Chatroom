<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chulpan Chatroom v1.0</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 20px;
        }

        #chat-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }

        #message-input {
            width: 70%;
            padding: 5px;
        }

        #send-btn {
            padding: 5px 10px;
            cursor: pointer;
        }

        #info-section {
            margin-top: 20px;
        }

        #sign-in-section {
            margin-top: 20px;
        }

        #sign-in-btn {
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="chat-container"></div>
    <div>
        <input type="text" id="message-input" placeholder="Type your message..." disabled>
        <button id="send-btn" onclick="sendMessage()" disabled>Send</button>
    </div>

    <div id="info-section">
        <p>Chulpan Chatroom v1.0</p>
        <p id="username-display"></p>
    </div>

    <div id="sign-in-section">
        <button id="sign-in-btn" onclick="signIn()">Sign In</button>
    </div>

    <script>
        let chatHistory = [];
        let currentIndex = 0;
        let signedIn = false;
        let username = '';

        // Load chat history from local storage
        try {
            const storedHistory = localStorage.getItem('chatHistory');
            if (storedHistory) {
                chatHistory = JSON.parse(storedHistory);
                currentIndex = chatHistory.length;
                displayChat();
            }
        } catch (error) {
            console.error('Error loading chat history from local storage:', error);
        }

        // Load signed-in status and username from local storage
        try {
            const storedSignedIn = localStorage.getItem('signedIn');
            if (storedSignedIn) {
                signedIn = JSON.parse(storedSignedIn);
            }

            const storedUsername = localStorage.getItem('username');
            if (storedUsername) {
                username = storedUsername;
                displayUsername();
            }
        } catch (error) {
            console.error('Error loading signed-in status and username from local storage:', error);
        }

        function signIn() {
            username = prompt("Please enter your username:");
            if (username) {
                alert(`Welcome, ${username}! You are now signed in.`);
                enableChat();
                displayUsername();
                saveToLocalStorage();
            } else {
                alert('Sign-in canceled. Please sign in to participate in the chat.');
            }
        }

        function enableChat() {
            document.getElementById('message-input').disabled = false;
            document.getElementById('send-btn').disabled = false;
            document.getElementById('sign-in-btn').disabled = true;
            signedIn = true;
        }

        function sendMessage() {
            if (!signedIn) {
                alert('You need to sign in before sending messages.');
                return;
            }

            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();

            if (message !== '') {
                const formattedMessage = `${username}: ${message}`;
                chatHistory.push(formattedMessage);
                currentIndex = chatHistory.length;
                displayChat();
                saveToLocalStorage();
                messageInput.value = '';
            }
        }

        function displayChat() {
            const chatContainer = document.getElementById('chat-container');
            chatContainer.innerHTML = '';

            const startIndex = Math.max(0, currentIndex - 20);
            const endIndex = Math.min(currentIndex, chatHistory.length);

            for (let i = startIndex; i < endIndex; i++) {
                const messageDiv = document.createElement('div');
                messageDiv.textContent = chatHistory[i];
                chatContainer.appendChild(messageDiv);
            }

            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function displayUsername() {
            const usernameDisplay = document.getElementById('username-display');
            usernameDisplay.textContent = `Signed in as: ${username}`;
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                localStorage.setItem('signedIn', JSON.stringify(signedIn));
                localStorage.setItem('username', username);
            } catch (error) {
                console.error('Error saving to local storage:', error);
            }
        }

        document.addEventListener('keydown', function (event) {
            if (!signedIn) {
                alert('You need to sign in before using the chat.');
                return;
            }

            if (event.key === 'ArrowLeft') {
                currentIndex = Math.max(0, currentIndex - 20);
                displayChat();
            } else if (event.key === 'ArrowRight') {
                currentIndex = Math.min(chatHistory.length, currentIndex + 20);
                displayChat();
            }
        });

        // Touch events for mobile swipes
        let touchStartX = 0;
        document.addEventListener('touchstart', function (event) {
            touchStartX = event.touches[0].clientX;
        });

        document.addEventListener('touchend', function (event) {
            const touchEndX = event.changedTouches[0].clientX;
            const swipeDistance = touchEndX - touchStartX;

            if (swipeDistance > 50) {
                // Swipe right
                currentIndex = Math.max(0, currentIndex - 20);
                displayChat();
            } else if (swipeDistance < -50) {
                // Swipe left
                currentIndex = Math.min(chatHistory.length, currentIndex + 20);
                displayChat();
            }
        });
    </script>
</body>
</html>
